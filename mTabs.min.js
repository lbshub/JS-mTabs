/**
 * LBS mTabs 
 * Date: 2014-5-10 
 **/
!function(a,b){"use strict";a.mTabs=function(a){a=a||{},void 0!==a.mtab&&(this.mtab="string"==typeof a.mtab?b.querySelector(a.mtab):a.mtab,void 0!==a.mhead&&(this.mhead="string"==typeof a.mhead?b.querySelector(a.mhead):a.mhead,void 0!==a.mcontent&&(this.mcontent="string"==typeof a.mcontent?b.querySelector(a.mcontent):a.mcontent,this.tagname=a.tagname||"li",this.mheads=this.mhead.children,this.mcontents=this.mcontent.children,this.length=this.mheads.length,this.length<1||(a.index>this.length-1&&(a.index=this.length-1),this.index=this.oIndex=a.index||0,this.current=a.current||"current",this.touch={},this.cache={},this.init()))))},mTabs.prototype={init:function(a){this.initSet(),this.bind()},initSet:function(){this.refix();for(var a=0;a<this.length;a++)this.mheads[a].index=a,this.mheads[a].className=this.mheads[a].className.replace(this.current,""),this.mcontents[a].className=this.mcontents[a].className.replace(this.current,"");this.mheads[this.index].className+=" "+this.current,this.mcontents[this.index].className+=" "+this.current},refix:function(){this.width=b.documentElement.clientWidth||b.body.clientWidth,this.mcontent.style.width=this.length*this.width+"px";for(var a=0;a<this.length;a++)this.mcontents[a].style.width=this.width+"px";this.setTransform(-this.index*this.width)},bind:function(){var a=this;this.on(this.mtab,["touchstart","pointerdown","MSPointerDown"],function(b){a.touchStart(b)}),this.on(this.mtab,["touchmove","pointermove","MSPointerMove"],function(b){a.touchMove(b)}),this.on(this.mtab,["touchend","touchcancel","pointerup","pointercancel","MSPointerUp","MSPointerCancel"],function(b){a.touchEnd(b)}),this.on(this.mcontent,["transitionEnd","webkitTransitionEnd","oTransitionEnd","MSTransitionEnd"],function(b){a.transitionEnd(b)}),this.on(this.mhead,"click",function(b){a.touchClick(b)}),this.on(window,["resize","orientationchange"],function(b){a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){a.refix()},100)})},touchStart:function(a){var b=a.touches?a.touches[0]:a;this.touch.x=b.pageX,this.touch.y=b.pageY,this.touch.time=Date.now(),this.touch.disX=0,this.touch.disY=0,this.touch.fixed=""},touchMove:function(a){if("up"!==this.touch.fixed){var b=a.touches?a.touches[0]:a;this.touch.disX=b.pageX-this.touch.x,this.touch.disY=b.pageY-this.touch.y,""===this.touch.fixed&&(Math.abs(this.touch.disY)>Math.abs(this.touch.disX)?this.touch.fixed="up":this.touch.fixed="left"),"left"===this.touch.fixed&&(a.stopPropagation(),a.preventDefault(),(0===this.index&&this.touch.disX>0||this.index===this.length-1&&this.touch.disX<0)&&(this.touch.disX/=4),this.setTransform(this.touch.disX-this.index*this.width))}},touchEnd:function(a){if("left"===this.touch.fixed){var b=Math.abs(this.touch.disX);this.setTransition(300),(Date.now()-this.touch.time>100&&b>10||b>this.width/2)&&(this.touch.disX>0?this.index--:this.index++,this.index<0&&(this.index=0),this.index>this.length-1&&(this.index=this.length-1),this.index!==this.oIndex&&(this.setTransition(100),this.update())),this.setTransform(-this.index*this.width)}},transitionEnd:function(){this.setTransition()},touchClick:function(a){var b=a.target;if(1===b.nodeType&&b.tagName.toUpperCase()===this.tagname.toUpperCase()){if(b.index===this.index)return;a.preventDefault(),a.stopPropagation(),this.index=b.index,this.update(),this.setTransition(100),this.setTransform(-this.index*this.width)}},update:function(){this.mheads[this.index].className+=" "+this.current,this.mheads[this.oIndex].className=this.mheads[this.oIndex].className.replace(this.current,"").trim(),this.mcontents[this.index].className+=" "+this.current,this.mcontents[this.oIndex].className=this.mcontents[this.oIndex].className.replace(this.current,"").trim(),this.oIndex=this.index},on:function(a,b,c){if("string"==typeof b)return a.addEventListener(b,c,!1);for(var d=0,e=b.length;e>d;d++)a.addEventListener(b[d],c,!1)},setTransition:function(a){a=a||0,this.setStyle(this.mcontent,"transition","all "+a+"ms")},setTransform:function(a){a=a||0,this.setStyle(this.mcontent,"transform","translate3d("+a+"px,0px,0px)")},setStyle:function(a,b,c){!this.cache[a]&&(this.cache[a]={}),!this.cache[a][b]&&(this.cache[a][b]=this.prefix(b)),a.style[this.cache[a][b]||this.prefix(b)]=c},prefix:function(a){var b=document.createElement("div").style;if(a in b)return a;for(var c=["webkit","Moz","ms","O"],d=0,e=c.length,f="";e>d;d++)if(f=c[d]+"-"+a,f=f.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()}),f in b)return f}}}(window,document);